<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta content="width=device-width, initial-scale=1.0, maximum- scale=1.0, user-scalable=no" name="viewport">
    <title>Title</title>
    <style>
        :root {
            --actions-height: 45px;
        }

        * {
            box-sizing: border-box;
        }

        html, body {
            margin: 0;
            padding: 0;
        }

        svg {
            height: 19px;
        }


        .btn {
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }

        .bg-blue {
            background-color: #0088dd;
        }

        .bg-light-blue {
            background-color: #eef3ff;
        }

        .bg-grey {
            background-color: #cccccc;
        }

        .bg-white {
            background-color: white;
        }

        .bg-green {
            background-color: #2ce3a0;
        }

        .border-top {
            border-top: solid #cccccc 1px;
        }

        .m-small {
            margin: 7px !important;
        }

        .circle-container {
            border-radius: 50%;
            display: flex;
            align-items: center;
        }

        .circle-container svg {
            height: 15px;
            width: 15px;
            margin: 10px;
        }

        .disabled path {
            fill: #c3c5c7;
        }

        .no-display {
            display: none !important;
        }

        .editor-container {
            width: calc(100% - 60px);
            min-height: calc(100vh - var(--actions-height));
        }

        .editor {
            width: 100%;
            min-height: 30px;
            max-height: calc(100vh - var(--actions-height));
            overflow: auto;
            border: none;
            border-radius: 5px;
            padding: 20px 40px 20px 20px;
        }

        .editor:focus-visible {
            border: none;
            outline: none;
        }

        /*  for old Safari */
        .editor:focus {
            border: none;
            outline: none;
        }

        .editor:empty::before {
            content: attr(placeholder);
            font-size: 12px;
            color: gray;
            background-color: transparent;
            cursor: text;
        }

        #collapse-icon {
            display: none;
        }

        .expanded .editor {
            min-height: calc(100vh - var(--actions-height));
        }

        .expanded #expand-icon {
            display: none;
        }

        .expanded #collapse-icon {
            display: initial;
        }

        .expand-action {
            position: fixed;
            top: 20px;
            right: 20px;
        }

        .actions-container {
            position: fixed;
            bottom: 0px;
            left: 0px;
            right: 0px;
            height: var(--actions-height);
            padding: 5px 10px;
            display: flex;
            justify-content: space-between;
        }

        .text-actions {
            display: flex;
            align-items: center;
            overflow-y: auto;
            width: 0px;
        }

        .message-actions {
            display: flex;
            align-items: center;
        }

        .send-actions {
            overflow: hidden;
            white-space: nowrap;
            display: flex;
            flex-direction: row-reverse;
            align-items: center;
        }

        .send-actions .btn, .text-actions .btn {
            margin-right: 10px;
            margin-left: 15px;
        }

        .send-actions .circle-container {
            margin-right: 0px;
        }

        .message-actions .btn {
            padding-left: 15px;
        }

        .edit-mode #send-message-icon, .edit-mode #poll-attachment-action, .edit-mode #voice-note-action {
            display: none;
        }

        #cancel-edit-action, #finish-edit-icon {
            display: none;
        }

        #loading-overlay {
            position: fixed;
            width: 100vw;
            height: 100vh;
            z-index: 1000;
            background: rgba(0, 0, 0, 0.2);
            display: none;
        }

        .overlay-actions {
            position: absolute;
            display: flex;
            bottom: 0px;
            left: 0px;
            right: 0px;
            height: 45px;
            text-align: right;
        }

        .overlay-actions .btn {
            position: absolute;
            right: 20px;
            align-self: center;
        }

        .loader {
            border: 5px solid #f3f3f3;
            border-radius: 50%;
            border-top: 5px solid #111;
            width: 30px;
            height: 30px;
            -webkit-animation: spin 2s linear infinite; /* Safari */
            animation: spin 2s linear infinite;
            float: right;
            margin: 0px 20px;
            position: absolute;
            right: 0px;
        }

        @-webkit-keyframes spin {
            0% {
                -webkit-transform: rotate(0deg);
            }
            100% {
                -webkit-transform: rotate(360deg);
            }
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }
            100% {
                transform: rotate(360deg);
            }
        }

        #add-link-container {
            position: fixed;
            width: 100vw;
            height: 100vh;
            z-index: 1000;
            top: 0px;
        }

        #link-input {
            width: 100%;
            border: none;
            padding: 0px 20px;
        }

        #link-input:focus-visible {
            border: none;
            outline: none;
        }

        /*  for old Safari */
        #link-input:focus {
            border: none;
            outline: none;
        }

        #link-input.error {
            border: red 1px solid;
            box-shadow: 1px 1px 4px 1px red;
        }

    </style>
</head>
<body>

<div class="container">
    <div id="loading-overlay">
        <div class="overlay-actions bg-grey">
            <div class="loader"></div>
        </div>
    </div>
    <div class="rich-text-component" id="rich-text-container">
        <div class="expand-action" ontouchend="emitExpand(event)">
            <svg height="18px"
                 id="expand-icon" version="1.1" viewBox="0 0 18 18" width="18px" xmlns="http://www.w3.org/2000/svg"
                 xmlns:xlink="http://www.w3.org/1999/xlink">
                <title>Expand</title>
                <g fill="none" fill-rule="evenodd" id="Page-1" stroke="none" stroke-width="1">
                    <g fill="#C3C5C7" fill-rule="nonzero" id="Mobile-2" transform="translate(-338.000000, -376.000000)">
                        <g id="Group-30-Copy-8" transform="translate(0.000000, 360.000000)">
                            <g id="Group-22" transform="translate(17.000000, 16.285696)">
                                <path
                                    d="M329.426349,10.3571552 C329.426349,10.446441 329.381706,10.5468876 329.314742,10.6138519 L325.60938,14.3192135 L327.216525,15.9263583 C327.350454,16.060287 327.428579,16.2388586 327.428579,16.428591 C327.428579,16.8192165 327.104918,17.1428776 326.714293,17.1428776 L321.714287,17.1428776 C321.323661,17.1428776 321,16.8192165 321,16.428591 L321,11.4285851 C321,11.0379596 321.323661,10.7142985 321.714287,10.7142985 C321.904019,10.7142985 322.082591,10.7924236 322.216519,10.9263523 L323.823664,12.5334971 L327.529026,8.82813552 C327.59599,8.76117116 327.696437,8.71652825 327.785722,8.71652825 C327.875008,8.71652825 327.975455,8.76117116 328.042419,8.82813552 L329.314742,10.1004585 C329.381706,10.1674228 329.426349,10.2678694 329.426349,10.3571552 Z M338.142878,0.714286566 L338.142878,5.71429253 C338.142878,6.10491799 337.819216,6.42857909 337.428591,6.42857909 C337.238859,6.42857909 337.060287,6.350454 336.926358,6.21652527 L335.319213,4.60938049 L331.613852,8.31474205 C331.546888,8.38170642 331.446441,8.42634933 331.357155,8.42634933 C331.267869,8.42634933 331.167423,8.38170642 331.100458,8.31474205 L329.828136,7.04241911 C329.761171,6.97545474 329.716528,6.8750082 329.716528,6.78572237 C329.716528,6.69643655 329.761171,6.59599001 329.828136,6.52902564 L333.533497,2.82366408 L331.926352,1.21651931 C331.792424,1.08259058 331.714298,0.904018935 331.714298,0.714286566 C331.714298,0.3236611 332.03796,0 332.428585,0 L337.428591,0 C337.819216,0 338.142878,0.3236611 338.142878,0.714286566 Z"
                                    id=""></path>
                            </g>
                        </g>
                    </g>
                </g>
            </svg>
            <svg class="" id="collapse-icon"
                 viewBox="0 0 512 512"
                 xmlns="http://www.w3.org/2000/svg">
                <!--! Font Awesome Pro 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2022 Fonticons, Inc. -->
                <path
                    d="M473 7c-9.4-9.4-24.6-9.4-33.9 0l-87 87L313 55c-6.9-6.9-17.2-8.9-26.2-5.2S272 62.3 272 72V216c0 13.3 10.7 24 24 24H440c9.7 0 18.5-5.8 22.2-14.8s1.7-19.3-5.2-26.2l-39-39 87-87c9.4-9.4 9.4-24.6 0-33.9L473 7zM216 272H72c-9.7 0-18.5 5.8-22.2 14.8s-1.7 19.3 5.2 26.2l39 39L7 439c-9.4 9.4-9.4 24.6 0 33.9l32 32c9.4 9.4 24.6 9.4 33.9 0l87-87 39 39c6.9 6.9 17.2 8.9 26.2 5.2s14.8-12.5 14.8-22.2V296c0-13.3-10.7-24-24-24z"/>
            </svg>
        </div>
        <div class="editor-container">
            <div class="editor" contentEditable="true" id="editor"
                 onfocus="onEditorFocused(event)"
                 placeholder=""
            ></div>
        </div>
        <div class="actions-container">
            <div class="message-actions" id="message-actions-container">
                <span class="circle-container bg-light-blue" id="poll-attachment-action"
                      ontouchend="attachFileClicked(event)">
                    <svg height="15px" version="1.1" viewBox="0 0 15 15" width="15px" xmlns="http://www.w3.org/2000/svg"
                         xmlns:xlink="http://www.w3.org/1999/xlink">
                        <title>plus</title>
                        <g fill="none" fill-rule="evenodd" id="Page-1" stroke="none" stroke-width="1">
                            <g fill="#0088dd" fill-rule="nonzero" id="Mobile-2"
                               transform="translate(-19.000000, -416.000000)">
                                <g id="Group-30-Copy-8" transform="translate(0.000000, 360.000000)">
                                    <g id="Group-98" transform="translate(8.808207, 45.808207)">
                                        <path
                                            d="M24,21.6565657 C24,21.9090909 23.8989899,22.1616162 23.7171717,22.3434343 L22.3434343,23.7171717 C22.1616162,23.8989899 21.9090909,24 21.6565657,24 C21.4040404,24 21.1515152,23.8989899 20.969697,23.7171717 L18,20.7474747 L15.030303,23.7171717 C14.8484848,23.8989899 14.5959596,24 14.3434343,24 C14.0909091,24 13.8383838,23.8989899 13.6565657,23.7171717 L12.2828283,22.3434343 C12.1010101,22.1616162 12,21.9090909 12,21.6565657 C12,21.4040404 12.1010101,21.1515152 12.2828283,20.969697 L15.2525253,18 L12.2828283,15.030303 C12.1010101,14.8484848 12,14.5959596 12,14.3434343 C12,14.0909091 12.1010101,13.8383838 12.2828283,13.6565657 L13.6565657,12.2828283 C13.8383838,12.1010101 14.0909091,12 14.3434343,12 C14.5959596,12 14.8484848,12.1010101 15.030303,12.2828283 L18,15.2525253 L20.969697,12.2828283 C21.1515152,12.1010101 21.4040404,12 21.6565657,12 C21.9090909,12 22.1616162,12.1010101 22.3434343,12.2828283 L23.7171717,13.6565657 C23.8989899,13.8383838 24,14.0909091 24,14.3434343 C24,14.5959596 23.8989899,14.8484848 23.7171717,15.030303 L20.7474747,18 L23.7171717,20.969697 C23.8989899,21.1515152 24,21.4040404 24,21.6565657 Z"
                                            id=""
                                            transform="translate(18.000000, 18.000000) rotate(45.000000) translate(-18.000000, -18.000000) "></path>
                                    </g>
                                </g>
                            </g>
                        </g>
                    </svg>
                </span>
                <span class="btn" ontouchend="toggleTextActionsTouch(event)">
                    <?xml version="1.0" encoding="UTF-8"?>
                    <svg height="14px" version="1.1" viewBox="0 0 25 14" width="25px" xmlns="http://www.w3.org/2000/svg"
                         xmlns:xlink="http://www.w3.org/1999/xlink">
                        <title>Aa</title>
                        <g fill="none" fill-rule="evenodd" id="Page-1" stroke="none" stroke-width="1">
                            <g fill="#0088DD" fill-rule="nonzero" id="Aa-Copy">
                                <path
                                    d="M2.95316999,13.7689199 L3.78080998,11.6621999 L10.02573,11.6621999 L10.8533699,13.7689199 L13.7689199,13.7689199 L8.27639996,0 L5.51132997,0 L0,13.7689199 L2.95316999,13.7689199 Z M9.00998996,8.89712996 L4.87178998,8.89712996 L6.97850997,3.66794998 L9.00998996,8.89712996 Z"
                                    id="Shape"></path>
                                <path
                                    d="M21.7631699,4.58963998 L21.7631699,5.34203997 C21.3493499,4.90940998 20.6533799,4.66487998 19.7504999,4.58963998 C17.0982899,4.45796998 15.1608599,6.71516997 15.1608599,9.17927996 C15.1608599,11.7562499 17.0982899,13.7689199 19.7504999,13.7689199 C20.4088499,13.7689199 21.0860099,13.5243899 21.7631699,13.0353299 L21.7631699,13.7689199 L24.2460899,13.7689199 L24.2460899,4.60844998 L21.7631699,4.58963998 Z M19.7504999,11.6433899 C18.3209399,11.6433899 17.3992499,10.5712199 17.3992499,9.19808996 C17.3992499,7.82495996 18.3209399,6.73397997 19.7316899,6.73397997 C21.1424399,6.73397997 22.1017499,7.82495996 22.1017499,9.19808996 C22.1017499,10.5712199 21.1424399,11.6433899 19.7504999,11.6433899 Z"
                                    id="Shape"></path>
                            </g>
                        </g>
                    </svg>
                </span>
            </div>
            <div class="text-actions" id="text-actions-container">
                <span class="circle-container bg-blue"
                      ontouchend="toggleTextActions(event)">
                    <svg height="15px" version="1.1" viewBox="0 0 15 15" width="15px" xmlns="http://www.w3.org/2000/svg"
                         xmlns:xlink="http://www.w3.org/1999/xlink">
                        <title>Times</title>
                        <g fill="none" fill-rule="evenodd" id="Page-1" stroke="none" stroke-width="1">
                            <g fill="white" fill-rule="nonzero" id="Times---FontAwesome-Copy">
                                <path
                                    d="M14.5848388,11.7366211 C14.5848388,11.4297011 14.4620708,11.1227811 14.2410884,10.9017987 L10.6317091,7.29241941 L14.2410884,3.6830401 C14.4620708,3.4620577 14.5848388,3.15513769 14.5848388,2.84821768 C14.5848388,2.54129767 14.4620708,2.23437766 14.2410884,2.01339526 L12.5714436,0.34375041 C12.3504612,0.122768003 12.0435411,0 11.7366211,0 C11.4297011,0 11.1227811,0.122768003 10.9017987,0.34375041 L7.29241941,3.95312971 L3.6830401,0.34375041 C3.4620577,0.122768003 3.15513769,0 2.84821768,0 C2.54129767,0 2.23437766,0.122768003 2.01339526,0.34375041 L0.34375041,2.01339526 C0.122768003,2.23437766 0,2.54129767 0,2.84821768 C0,3.15513769 0.122768003,3.4620577 0.34375041,3.6830401 L3.95312971,7.29241941 L0.34375041,10.9017987 C0.122768003,11.1227811 0,11.4297011 0,11.7366211 C0,12.0435411 0.122768003,12.3504612 0.34375041,12.5714436 L2.01339526,14.2410884 C2.23437766,14.4620708 2.54129767,14.5848388 2.84821768,14.5848388 C3.15513769,14.5848388 3.4620577,14.4620708 3.6830401,14.2410884 L7.29241941,10.6317091 L10.9017987,14.2410884 C11.1227811,14.4620708 11.4297011,14.5848388 11.7366211,14.5848388 C12.0435411,14.5848388 12.3504612,14.4620708 12.5714436,14.2410884 L14.2410884,12.5714436 C14.4620708,12.3504612 14.5848388,12.0435411 14.5848388,11.7366211 Z"
                                    id="Path"></path>
                            </g>
                        </g>
                    </svg>
                </span>
                <span class="btn" ontouchend="execCmdTouch(event, 'bold')">
                    <svg height="15px" version="1.1" viewBox="0 0 12 15" width="12px" xmlns="http://www.w3.org/2000/svg"
                         xmlns:xlink="http://www.w3.org/1999/xlink">
                        <title>Bold</title>
                        <g fill="none" fill-rule="evenodd" id="Page-1" stroke="none" stroke-width="1">
                            <path
                                d="M0,14.9501374 L0,0 L5.1234746,0 C6.97454806,0 8.4194809,0.344010989 9.45786189,1.03195055 C10.4960784,1.71980769 11.01531,2.745 11.01531,4.1071978 C11.01531,4.8192033 10.8480998,5.45208791 10.5132682,6.00684066 C10.1785189,6.56142857 9.6628239,6.97895604 8.96593661,7.25950549 C9.84031509,7.45796703 10.4857974,7.8567033 10.9026302,8.45571429 C11.3191341,9.05472527 11.527715,9.74447802 11.527715,10.5247253 C11.527715,11.9827747 11.0392442,13.0849451 10.0625492,13.8309066 C9.0855252,14.5771978 7.68525302,14.9501374 5.8611569,14.9501374 L0,14.9501374 Z M3.47374423,6.23266484 L5.19519485,6.23266484 C5.98074549,6.21898352 6.56832519,6.06667582 6.95776947,5.77565934 C7.3471315,5.48480769 7.54189476,5.05870879 7.54189476,4.49736264 C7.54189476,3.86068681 7.34367708,3.39708791 6.94765296,3.10607143 C6.55121761,2.81521978 5.94332265,2.66967033 5.12355684,2.66967033 L3.47374423,2.66967033 L3.47374423,6.23266484 L3.47374423,6.23266484 Z M3.47374423,8.53277473 L3.47374423,12.2805495 L5.8611569,12.2805495 C6.5990037,12.2805495 7.15236823,12.135 7.52125051,11.8439835 C7.89005054,11.5531319 8.07469729,11.1065934 8.07469729,10.5042033 C8.07469729,9.85384615 7.91579416,9.36271978 7.59807014,9.03065934 C7.28051062,8.69876374 6.76646062,8.53277473 6.05608466,8.53277473 L3.47374423,8.53277473 L3.47374423,8.53277473 Z"
                                fill="#8B8B8B" fill-rule="nonzero" id="bold-icon"></path>
                        </g>
                    </svg>
                </span>
                <span class="btn" ontouchend="execCmdTouch(event, 'italic')">
                    <svg height="15px" version="1.1" viewBox="0 0 13 15" width="13px" xmlns="http://www.w3.org/2000/svg"
                         xmlns:xlink="http://www.w3.org/1999/xlink">
                        <title>Italic</title>
                        <g fill="none" fill-rule="evenodd" id="Page-1" stroke="none" stroke-width="1">
                            <polygon fill="#8B8B8B" fill-rule="nonzero" id="Path-Copy-6"
                                     points="4.28574298 0 4.28574298 3.21428213 6.65893788 3.21428213 2.98395872 11.7857179 0 11.7857179 0 15 8.57143575 15 8.57143575 11.7857179 6.19824085 11.7857179 9.87322001 3.21428213 12.8571285 3.21428213 12.8571285 0"></polygon>
                        </g>
                    </svg>
                </span>
                <span class="btn"
                      ontouchend="execCmdTouch(event, 'strikeThrough')">
                    <svg height="15px" version="1.1" viewBox="0 0 13 15" width="13px" xmlns="http://www.w3.org/2000/svg"
                         xmlns:xlink="http://www.w3.org/1999/xlink">
                        <title>Strikethrough</title>
                        <g fill="none" fill-rule="evenodd" id="Page-1" stroke="none" stroke-width="1">
                            <path
                                d="M13,6.70252392 L8.24500235,6.70252392 C8.0514699,6.59398883 7.85121119,6.48561428 7.63566557,6.37723974 C6.65363358,5.88513904 6.03130292,5.54395993 5.7685207,5.35418406 C5.50543274,5.1647293 5.31373471,4.96853124 5.19342662,4.76542932 C5.07296566,4.56248796 5.01288805,4.32454563 5.01288805,4.05176289 C5.01288805,3.61248475 5.16162982,3.25669514 5.4594191,2.98375185 C5.75720837,2.71129022 6.1849365,2.57465802 6.74275635,2.57465802 C7.21130056,2.57465802 7.68809972,2.63823775 8.1726952,2.76443388 C8.65729069,2.89095113 9.27029633,3.11364074 10.0114064,3.43314495 L10.9614887,1.02787233 C10.2456021,0.70210648 9.56013641,0.449232548 8.90417451,0.26957164 C8.24836548,0.0897501766 7.55968956,0 6.83753528,0 C5.36754468,0 4.21628645,0.369276219 3.38299624,1.10782866 C2.54985889,1.84638109 2.13329022,2.86108792 2.13329022,4.15162803 C2.13329022,4.83719735 2.26017168,5.43590649 2.51332314,5.94807655 C2.64647225,6.21748764 2.80469191,6.4681138 2.98523048,6.70252392 L0,6.70252392 L0,8.29763663 L5.04086312,8.29763663 C5.16896754,8.36587246 5.3008937,8.43426883 5.44061618,8.50314688 C6.34651929,8.95526941 6.94698965,9.28504913 7.24126294,9.49088048 C7.53568909,9.6971935 7.75903104,9.91169482 7.91113594,10.1348661 C8.06324083,10.3577163 8.13906397,10.6121957 8.13906397,10.898144 C8.13906397,11.410314 7.96616886,11.7964485 7.62129586,12.0559052 C7.27581138,12.3153619 6.77990357,12.4449297 6.13418391,12.4449297 C5.59547272,12.4449297 5.00157573,12.3551795 4.35234008,12.1755186 C3.70264581,11.9958577 2.90956021,11.6864684 1.9718603,11.2471903 L1.9718603,14.1216043 C3.11226482,14.7069873 4.42342427,15 5.90579727,15 C7.514746,15 8.77087253,14.6206088 9.67371825,13.8623081 C10.5761054,13.1036863 11.0272225,12.0658596 11.0272225,10.7483463 C11.0272225,9.79689808 10.7866063,8.99332092 10.3050682,8.33809646 C10.2951317,8.3244493 10.2822907,8.31096269 10.2717427,8.29731552 L12.9996943,8.29731552 L12.9996943,6.70252392 L13,6.70252392 Z"
                                fill="#8B8B8B" fill-rule="nonzero" id="Path-Copy-3"></path>
                        </g>
                    </svg>
                </span>
                <span class="btn" ontouchend="execCmdTouch(event, 'Underline')">
                    <svg height="15px" version="1.1" viewBox="0 0 12 15" width="12px" xmlns="http://www.w3.org/2000/svg"
                         xmlns:xlink="http://www.w3.org/1999/xlink">
                        <title>Underline</title>
                        <g fill="none" fill-rule="evenodd" id="Page-1" stroke="none" stroke-width="1">
                            <g fill="#8B8B8B" fill-rule="nonzero" id="Group-119">
                                <polygon id="Path"
                                         points="0 13.124988 11.250008 13.124988 11.250008 15 2.27852469e-16 15"></polygon>
                                <path
                                    d="M7.49998397,0 L7.49998397,1.87501203 L8.43747395,1.87501203 L8.43747395,7.50001603 C8.43747395,9.05092301 7.17587891,10.312518 5.62497194,10.312518 C4.07406497,10.312518 2.81246994,9.05092301 2.81246994,7.50001603 L2.81246994,1.87501203 L3.74995992,1.87501203 L3.74995992,0 L0,0 L0,1.87501203 L0.937489979,1.87501203 L0.937489979,7.50001603 C0.937489979,10.084551 3.04043697,12.187498 5.62497194,12.187498 C8.20950691,12.187498 10.3124539,10.084551 10.3124539,7.50001603 L10.3124539,1.87501203 L11.2499439,1.87501203 L11.2499439,0 L7.49998397,0 Z"
                                    id="Path"></path>
                            </g>
                        </g>
                    </svg>
                </span>
                <span class="btn" ontouchend="showAddLink(event)">
                    <svg height="15px" version="1.1" viewBox="0 0 15 15" width="15px" xmlns="http://www.w3.org/2000/svg"
                         xmlns:xlink="http://www.w3.org/1999/xlink">
                        <title>Link</title>
                        <g fill="none" fill-rule="evenodd" id="Page-1" stroke="none" stroke-width="1">
                            <g fill="#8B8B8B" fill-rule="nonzero" id="Group-118">
                                <path
                                    d="M13.9371953,1.00248086 C12.6035646,-0.333899504 10.4334991,-0.334175578 9.09968485,1.00174467 L9.09996035,1.00202074 L6.98967955,3.11702074 L7.9637754,4.09294099 L10.0744235,1.97748086 L10.0742399,1.97729682 C10.8711856,1.18008823 12.1667047,1.18054835 12.9630994,1.97858516 C13.759586,2.77662197 13.7594942,4.07545632 12.9630994,4.87376921 L9.79607109,8.04714344 C9.41027146,8.43383056 8.89728009,8.64677534 8.3515954,8.64677534 C7.80591071,8.64677534 7.29282751,8.43383056 6.90702788,8.04714344 L5.93293203,9.02315571 C6.57899258,9.67054835 7.43801894,10.0271434 8.35168724,10.0271434 C9.26535553,10.0271434 10.1243819,9.67054835 10.7701669,9.02315571 L13.9372871,5.84978148 C15.2706422,4.51312504 15.2706422,2.33858516 13.9371953,1.00248086 Z"
                                    id="Path-Copy-4"></path>
                                <path
                                    d="M4.86351125,12.9903336 L4.86351125,12.9903336 C4.06684099,13.7881864 2.77077097,13.7880023 1.97428437,12.9898735 C1.17779778,12.1915606 1.17779778,10.8925422 1.97419254,10.0943214 L5.14085352,6.92113117 C5.93752379,6.12291031 7.23368564,6.12291031 8.03017224,6.92113117 L9.00435992,5.9451189 C7.67054564,4.60864651 5.50048012,4.60855448 4.16684951,5.9451189 L1,9.11830909 C-0.333350256,10.4547815 -0.333350256,12.6294134 1.00009669,13.9659778 C1.66709567,14.63426 2.5430197,14.9683091 3.4191274,14.9683091 C4.29486776,14.9683091 5.17079179,14.634352 5.83742343,13.9664379 L5.8376071,13.9663459 L7.94834709,11.8507017 L6.9741594,10.8746895 L4.86351125,12.9903336 Z"
                                    id="Path-Copy-5"></path>
                            </g>
                        </g>
                    </svg>
                </span>
                <span class="btn"
                      ontouchend="execCmdTouch(event, 'insertUnorderedList')">
                    <svg height="17px" version="1.1" viewBox="0 0 22 17" width="22px" xmlns="http://www.w3.org/2000/svg"
                         xmlns:xlink="http://www.w3.org/1999/xlink">
                        <title>Bullet list</title>
                        <g fill="none" fill-rule="evenodd" id="Page-1" stroke="none" stroke-width="1">
                            <g fill="#8B8B8B" fill-rule="nonzero" id="Group-117">
                                <path
                                    d="M20.8439841,16.4305 L6.17394109,16.4305 C5.56931814,16.4305 5.07927069,15.9341739 5.07927069,15.3218043 C5.07927069,14.7094348 5.56931814,14.2131087 6.17394109,14.2131087 L20.8436192,14.2131087 C21.4482422,14.2131087 21.9382896,14.7094348 21.9382896,15.3218043 C21.9382896,15.9341739 21.4486071,16.4305 20.8439841,16.4305 Z"
                                    id="Path"></path>
                                <path
                                    d="M20.8439841,9.47121739 L6.17394109,9.47121739 C5.56931814,9.47121739 5.07927069,8.9748913 5.07927069,8.36252174 C5.07927069,7.75015217 5.56931814,7.25382609 6.17394109,7.25382609 L20.8436192,7.25382609 C21.4482422,7.25382609 21.9382898,7.75015217 21.9382898,8.36252174 C21.9386545,8.9748913 21.4486071,9.47121739 20.8439841,9.47121739 Z"
                                    id="Path"></path>
                                <path
                                    d="M20.8439841,2.51193478 L6.17394109,2.51193478 C5.56931814,2.51193478 5.07927069,2.0156087 5.07927069,1.40323913 C5.07927069,0.790869565 5.56931814,0.294543478 6.17394109,0.294543478 L20.8436192,0.294543478 C21.4482422,0.294543478 21.9382896,0.790869565 21.9382896,1.40323913 C21.9382896,2.0156087 21.4486071,2.51193478 20.8439841,2.51193478 Z"
                                    id="Path"></path>
                                <ellipse cx="1.47014236" cy="1.48897826" id="Oval" rx="1.47014236"
                                         ry="1.48897826"></ellipse>
                                <ellipse cx="1.47014236" cy="8.36252174" id="Oval" rx="1.47014236"
                                         ry="1.48897826"></ellipse>
                                <ellipse cx="1.47014236" cy="15.2360652" id="Oval" rx="1.47014236"
                                         ry="1.48897826"></ellipse>
                            </g>
                        </g>
                    </svg>
                </span>
                <span class="btn"
                      ontouchend="execCmdTouch(event, 'insertOrderedList')">
                    <svg height="17px" version="1.1" viewBox="0 0 23 17" width="23px" xmlns="http://www.w3.org/2000/svg"
                         xmlns:xlink="http://www.w3.org/1999/xlink">
                        <title>Numbered list</title>
                        <g fill="none" fill-rule="evenodd" id="Page-1" stroke="none" stroke-width="1">
                            <g fill="#8B8B8B" fill-rule="nonzero" id="Group-116">
                                <path
                                    d="M20.984267,16.4305 L6.31422395,16.4305 C5.70960099,16.4305 5.21955354,15.9341739 5.21955354,15.3218043 C5.21955354,14.7094348 5.70960099,14.2131087 6.31422395,14.2131087 L20.9839021,14.2131087 C21.588525,14.2131087 22.0785725,14.7094348 22.0785725,15.3218043 C22.0785725,15.9341739 21.5888899,16.4305 20.984267,16.4305 Z"
                                    id="Path"></path>
                                <path
                                    d="M20.984267,9.47121739 L6.31422395,9.47121739 C5.70960099,9.47121739 5.21955354,8.9748913 5.21955354,8.36252174 C5.21955354,7.75015217 5.70960099,7.25382609 6.31422395,7.25382609 L20.9839021,7.25382609 C21.588525,7.25382609 22.0785727,7.75015217 22.0785727,8.36252174 C22.0789374,8.9748913 21.5888899,9.47121739 20.984267,9.47121739 Z"
                                    id="Path"></path>
                                <path
                                    d="M2.47962184,10.818169 L0.572231172,10.818169 C0.256358456,10.818169 0,10.5585352 0,10.2386267 L0,9.27267581 C0,8.52702456 0.598914812,7.92045776 1.33515949,7.92045776 L1.71669352,7.92045776 C1.82203098,7.92045776 1.90739066,7.833866 1.90739066,7.72732419 L1.90739066,7.5340491 C1.90739066,7.42750728 1.82203098,7.34091552 1.71669352,7.34091552 L0.572231172,7.34091552 C0.256358456,7.34091552 0,7.08128172 0,6.76137329 C0,6.44146485 0.256358456,6.18183105 0.572231172,6.18183105 L1.71669352,6.18183105 C2.45293823,6.18183105 3.05185301,6.78839785 3.05185301,7.5340491 L3.05185301,7.72732419 C3.05185301,8.47297544 2.45293823,9.07954224 1.71669352,9.07954224 L1.33515949,9.07954224 C1.22996173,9.07954224 1.14446234,9.166134 1.14446234,9.27267581 L1.14446234,9.65908448 L2.47962184,9.65908448 C2.79549455,9.65908448 3.05185301,9.91871828 3.05185301,10.2386267 C3.05185301,10.5585352 2.79549455,10.818169 2.47962184,10.818169 Z"
                                    id="Path"></path>
                                <path
                                    d="M1.71669352,15.2613733 L0.953765198,15.2613733 C0.637892482,15.2613733 0.381534025,15.0017395 0.381534025,14.681831 C0.381534025,14.3619226 0.637892482,14.1022888 0.953765198,14.1022888 L1.71669352,14.1022888 C1.82203098,14.1022888 1.90739066,14.015697 1.90739066,13.9090137 L1.90739066,13.7158801 C1.90739066,13.6091968 1.82203098,13.5227466 1.71669352,13.5227466 L0.572231172,13.5227466 C0.256358456,13.5227466 0,13.2631128 0,12.9432043 C0,12.6232959 0.256358456,12.3636621 0.572231172,12.3636621 L1.71669352,12.3636621 C2.45293823,12.3636621 3.05185301,12.9702289 3.05185301,13.7158801 L3.05185301,13.9090137 C3.05185301,14.6548065 2.45293823,15.2613733 1.71669352,15.2613733 L1.71669352,15.2613733 Z"
                                    id="Path"></path>
                                <path
                                    d="M1.71669352,17 L0.572231172,17 C0.256358456,17 0,16.7403662 0,16.4204578 C0,16.1005493 0.256358456,15.8409155 0.572231172,15.8409155 L1.71669352,15.8409155 C1.82203098,15.8409155 1.90739066,15.7543238 1.90739066,15.6476404 L1.90739066,15.4545069 C1.90739066,15.3478236 1.82203098,15.2613733 1.71669352,15.2613733 L0.953765198,15.2613733 C0.637892482,15.2613733 0.381534025,15.0017395 0.381534025,14.681831 C0.381534025,14.3619226 0.637892482,14.1022888 0.953765198,14.1022888 L1.71669352,14.1022888 C2.45293823,14.1022888 3.05185301,14.7088556 3.05185301,15.4545069 L3.05185301,15.6476404 C3.05185301,16.3934332 2.45293823,17 1.71669352,17 L1.71669352,17 Z"
                                    id="Path"></path>
                                <path
                                    d="M1.71669352,4.63633791 C1.4008208,4.63633791 1.14446234,4.37670411 1.14446234,4.05679567 L1.14446234,1.15908448 L0.572231172,1.15908448 C0.256358456,1.15908448 0,0.899450677 0,0.579542238 C0,0.2596338 0.256358456,0 0.572231172,0 L1.71669352,0 C2.03256623,0 2.28892469,0.2596338 2.28892469,0.579542238 L2.28892469,4.05679567 C2.28892469,4.37670411 2.03256623,4.63633791 1.71669352,4.63633791 Z"
                                    id="Path"></path>
                                <path
                                    d="M20.984267,2.51193478 L6.31422395,2.51193478 C5.70960099,2.51193478 5.21955354,2.0156087 5.21955354,1.40323913 C5.21955354,0.790869565 5.70960099,0.294543478 6.31422395,0.294543478 L20.9839021,0.294543478 C21.588525,0.294543478 22.0785725,0.790869565 22.0785725,1.40323913 C22.0785725,2.0156087 21.5888899,2.51193478 20.984267,2.51193478 Z"
                                    id="Path"></path>
                            </g>
                        </g>
                    </svg>
                </span>
                <span class="btn" ontouchend="execCmdTouch(event, 'indent')">
                    <svg height="17px" version="1.1" viewBox="0 0 18 17" width="18px" xmlns="http://www.w3.org/2000/svg"
                         xmlns:xlink="http://www.w3.org/1999/xlink">
                        <title>Decrease indent</title>
                        <g fill="none" fill-rule="evenodd" id="Page-1" stroke="none" stroke-width="1">
                            <g fill="#8B8B8B" fill-rule="nonzero" id="Group-114">
                                <path
                                    d="M15.984267,16.1359565 L1.31422395,16.1359565 C0.709600992,16.1359565 0.21955354,15.6396304 0.21955354,15.0272609 C0.21955354,14.4148913 0.709600992,13.9185652 1.31422395,13.9185652 L15.9839021,13.9185652 C16.588525,13.9185652 17.0785725,14.4148913 17.0785725,15.0272609 C17.0785725,15.6396304 16.5888899,16.1359565 15.984267,16.1359565 Z"
                                    id="Path"></path>
                                <path
                                    d="M16.2996621,9.17667391 L5.85774285,9.17667391 C5.42738119,9.17667391 5.07857268,8.68034783 5.07857268,8.06797826 C5.07857268,7.4556087 5.42738119,6.95928261 5.85774285,6.95928261 L16.2994024,6.95928261 C16.729764,6.95928261 17.0785727,7.4556087 17.0785727,8.06797826 C17.0788323,8.68034783 16.7300237,9.17667391 16.2996621,9.17667391 Z"
                                    id="Path"></path>
                                <path
                                    d="M3.15167891,8.30833909 C3.15167891,8.22191526 3.11337725,8.14057518 3.04771728,8.07957012 L0.59641146,5.80204787 C0.530751482,5.74104281 0.443204846,5.70545652 0.350186545,5.70545652 C0.158678278,5.70545652 0,5.85288542 0,6.03081684 L0,10.5858613 C0,10.7637928 0.158678278,10.9112217 0.350186545,10.9112217 C0.443204846,10.9112217 0.530751482,10.8756354 0.59641146,10.8146303 L3.04771728,8.53710807 C3.11337725,8.47610301 3.15167891,8.39476293 3.15167891,8.30833909 Z"
                                    id="Path"></path>
                                <path
                                    d="M15.984267,2.2173913 L1.31422395,2.2173913 C0.709600992,2.2173913 0.21955354,1.72106522 0.21955354,1.10869565 C0.21955354,0.496326087 0.709600992,0 1.31422395,0 L15.9839021,0 C16.588525,0 17.0785725,0.496326087 17.0785725,1.10869565 C17.0785725,1.72106522 16.5888899,2.2173913 15.984267,2.2173913 Z"
                                    id="Path"></path>
                            </g>
                        </g>
                    </svg>
                </span>
                <span class="btn" ontouchend="execCmdTouch(event, 'outdent')">
                    <svg height="17px" version="1.1" viewBox="0 0 18 17" width="18px" xmlns="http://www.w3.org/2000/svg"
                         xmlns:xlink="http://www.w3.org/1999/xlink">
                        <title>Increase indent</title>
                        <g fill="none" fill-rule="evenodd" id="Page-1" stroke="none" stroke-width="1">
                            <g fill="#8B8B8B" fill-rule="nonzero" id="Group-115">
                                <path
                                    d="M15.984267,16.1359565 L1.31422395,16.1359565 C0.709600992,16.1359565 0.21955354,15.6396304 0.21955354,15.0272609 C0.21955354,14.4148913 0.709600992,13.9185652 1.31422395,13.9185652 L15.9839021,13.9185652 C16.588525,13.9185652 17.0785725,14.4148913 17.0785725,15.0272609 C17.0785725,15.6396304 16.5888899,16.1359565 15.984267,16.1359565 Z"
                                    id="Path"></path>
                                <path
                                    d="M16.2996621,9.17667391 L5.85774285,9.17667391 C5.42738119,9.17667391 5.07857268,8.68034783 5.07857268,8.06797826 C5.07857268,7.4556087 5.42738119,6.95928261 5.85774285,6.95928261 L16.2994024,6.95928261 C16.729764,6.95928261 17.0785727,7.4556087 17.0785727,8.06797826 C17.0788323,8.68034783 16.7300237,9.17667391 16.2996621,9.17667391 Z"
                                    id="Path"></path>
                                <path
                                    d="M3.15167891,8.30833909 C3.15167891,8.22191526 3.11337725,8.14057518 3.04771728,8.07957012 L0.59641146,5.80204787 C0.530751482,5.74104281 0.443204846,5.70545652 0.350186545,5.70545652 C0.158678278,5.70545652 0,5.85288542 0,6.03081684 L0,10.5858613 C0,10.7637928 0.158678278,10.9112217 0.350186545,10.9112217 C0.443204846,10.9112217 0.530751482,10.8756354 0.59641146,10.8146303 L3.04771728,8.53710807 C3.11337725,8.47610301 3.15167891,8.39476293 3.15167891,8.30833909 Z"
                                    id="Path"
                                    transform="translate(1.575839, 8.308339) scale(-1, 1) translate(-1.575839, -8.308339) "></path>
                                <path
                                    d="M15.984267,2.2173913 L1.31422395,2.2173913 C0.709600992,2.2173913 0.21955354,1.72106522 0.21955354,1.10869565 C0.21955354,0.496326087 0.709600992,0 1.31422395,0 L15.9839021,0 C16.588525,0 17.0785725,0.496326087 17.0785725,1.10869565 C17.0785725,1.72106522 16.5888899,2.2173913 15.984267,2.2173913 Z"
                                    id="Path"></path>
                            </g>
                        </g>
                    </svg>
                </span>

            </div>
            <div class="send-actions" id="send-actions-container">
                <span class="btn circle-container bg-green" id="send-message-icon"
                      ontouchend="sendClicked(event)">
                    <svg height="18px" version="1.1" viewBox="0 0 19 18" width="19px" xmlns="http://www.w3.org/2000/svg"
                         xmlns:xlink="http://www.w3.org/1999/xlink">
                        <title>Send Message</title>
                        <g fill="none" fill-rule="evenodd" id="Page-1" stroke="none" stroke-width="1">
                            <g fill="#C3C5C7" fill-rule="nonzero" id="Mobile-2"
                               transform="translate(-338.000000, -414.000000)">
                                <g id="Group-30-Copy-8" transform="translate(0.000000, 360.000000)">
                                    <g id="Group-23" transform="translate(338.829268, 54.024390)">
                                        <path
                                            d="M16.7938685,6.87332359 L2.6854782,0.183870288 C1.75615286,-0.257472166 0.63768281,0.122927598 0.187226988,1.03352519 C-0.0424565429,1.49784193 -0.0616668366,2.03551892 0.134307376,2.51447192 L2.3383051,7.91156802 L17.7394094,7.91156802 C17.5772541,7.45626923 17.2371296,7.08277606 16.7938685,6.87332359 Z"
                                            fill="white"
                                            id="Path"></path>
                                        <path
                                            d="M2.3383051,9.13303417 L0.134307376,14.531347 C-0.248145467,15.4738294 0.22155717,16.5416685 1.18342315,16.9164499 C1.40120068,17.0012973 1.63333115,17.045385 1.86768943,17.046387 C2.15087691,17.046387 2.43041225,16.9837624 2.68544168,16.8631653 L16.793832,10.1712786 C17.2370931,9.96179034 17.5772541,9.58829718 17.7393729,9.13303417 L2.3383051,9.13303417 L2.3383051,9.13303417 Z"
                                            fill="white"
                                            id="Path"></path>
                                    </g>
                                </g>
                            </g>
                        </g>
                    </svg>
                </span>
                <span class="btn no-display" id="finish-edit-icon" ontouchend="sendClicked(event)">
                    <title>send message</title>
                   <svg viewBox="0 0 512 512"
                        xmlns="http://www.w3.org/2000/svg">
                       <path
                           d="M470.6 105.4c12.5 12.5 12.5 32.8 0 45.3l-256 256c-12.5 12.5-32.8 12.5-45.3 0l-128-128c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0L192 338.7 425.4 105.4c12.5-12.5 32.8-12.5 45.3 0z"/>
                   </svg>
                </span>
                <span class="btn no-display" id="cancel-edit-action"
                      ontouchend="onCancelEditClick(event)">
                    <svg height="15px" version="1.1" viewBox="0 0 15 15" width="15px" xmlns="http://www.w3.org/2000/svg"
                         xmlns:xlink="http://www.w3.org/1999/xlink">
                        <title>Times</title>
                        <g fill="none" fill-rule="evenodd" id="Page-1" stroke="none" stroke-width="1">
                            <g fill="#555555" fill-rule="nonzero" id="Times---FontAwesome-Copy">
                                <path
                                    d="M14.5848388,11.7366211 C14.5848388,11.4297011 14.4620708,11.1227811 14.2410884,10.9017987 L10.6317091,7.29241941 L14.2410884,3.6830401 C14.4620708,3.4620577 14.5848388,3.15513769 14.5848388,2.84821768 C14.5848388,2.54129767 14.4620708,2.23437766 14.2410884,2.01339526 L12.5714436,0.34375041 C12.3504612,0.122768003 12.0435411,0 11.7366211,0 C11.4297011,0 11.1227811,0.122768003 10.9017987,0.34375041 L7.29241941,3.95312971 L3.6830401,0.34375041 C3.4620577,0.122768003 3.15513769,0 2.84821768,0 C2.54129767,0 2.23437766,0.122768003 2.01339526,0.34375041 L0.34375041,2.01339526 C0.122768003,2.23437766 0,2.54129767 0,2.84821768 C0,3.15513769 0.122768003,3.4620577 0.34375041,3.6830401 L3.95312971,7.29241941 L0.34375041,10.9017987 C0.122768003,11.1227811 0,11.4297011 0,11.7366211 C0,12.0435411 0.122768003,12.3504612 0.34375041,12.5714436 L2.01339526,14.2410884 C2.23437766,14.4620708 2.54129767,14.5848388 2.84821768,14.5848388 C3.15513769,14.5848388 3.4620577,14.4620708 3.6830401,14.2410884 L7.29241941,10.6317091 L10.9017987,14.2410884 C11.1227811,14.4620708 11.4297011,14.5848388 11.7366211,14.5848388 C12.0435411,14.5848388 12.3504612,14.4620708 12.5714436,14.2410884 L14.2410884,12.5714436 C14.4620708,12.3504612 14.5848388,12.0435411 14.5848388,11.7366211 Z"
                                    id="Path"></path>
                            </g>
                        </g>
                    </svg>
                </span>
                <span class="btn no-display" id="voice-note-action"
                      ontouchend="voiceMessageClicked(event)">
                    <svg height="19px" version="1.1" viewBox="0 0 14 19" width="14px" xmlns="http://www.w3.org/2000/svg"
                         xmlns:xlink="http://www.w3.org/1999/xlink">
                        <title>Mic</title>
                        <g fill="none" fill-rule="evenodd" id="Page-1" stroke="none" stroke-width="1">
                            <g fill="#8B8B8B" fill-rule="nonzero" id="Mobile-2"
                               transform="translate(-299.000000, -414.000000)">
                                <g id="Group-30-Copy-8" transform="translate(0.000000, 360.000000)">
                                    <path
                                        d="M310.8272,62.6625002 L312.4442,62.6625002 C312.4442,63.7405056 312.182403,64.7568955 311.6588,65.7117003 C311.150598,66.6203048 310.453755,67.3787472 309.56825,67.9870503 C308.682746,68.5953534 307.716405,68.9687996 306.6692,69.1074003 L306.6692,72.2721004 L304.775,72.2721004 L304.775,69.1074003 C303.727795,68.9687996 302.761455,68.5953534 301.87595,67.9870503 C300.990446,67.3787472 300.293603,66.6203048 299.7854,65.7117003 C299.261797,64.7568955 299,63.7405056 299,62.6625002 L300.617,62.6625002 C300.617,63.6019049 300.863398,64.4565964 301.3562,65.2266002 C301.818202,65.9504039 302.438046,66.5240482 303.21575,66.9475503 C303.993454,67.3710524 304.828896,67.5828003 305.7221,67.5828003 C306.615305,67.5828003 307.450746,67.3710524 308.22845,66.9475503 C309.006154,66.5240482 309.625998,65.9504039 310.088,65.2266002 C310.580803,64.4565964 310.8272,63.6019049 310.8272,62.6625002 Z M305.7221,65.5500003 C305.213898,65.5500003 304.736502,65.4191016 304.2899,65.1573002 C303.843298,64.8954989 303.489101,64.5413025 303.2273,64.0947002 C302.965499,63.648098 302.8346,63.1707027 302.8346,62.6625002 L302.8346,56.8875001 C302.8346,56.3792975 302.965499,55.9019023 303.2273,55.4553 C303.489101,55.0086978 303.843298,54.6545013 304.2899,54.3927 C304.736502,54.1308987 305.213898,54 305.7221,54 C306.230303,54 306.707698,54.1308987 307.1543,54.3927 C307.600902,54.6545013 307.955099,55.0086978 308.2169,55.4553 C308.478702,55.9019023 308.6096,56.3792975 308.6096,56.8875001 L308.6096,62.6625002 C308.6096,63.1707027 308.478702,63.648098 308.2169,64.0947002 C307.955099,64.5413025 307.600902,64.8954989 307.1543,65.1573002 C306.707698,65.4191016 306.230303,65.5500003 305.7221,65.5500003 Z"
                                        id=""></path>
                                </g>
                            </g>
                        </g>
                    </svg>
                </span>
                <span class="btn no-display" id="red-flag-action" ontouchend="toggleRedFlag(event)">
                    <svg height="20px" version="1.1" viewBox="0 0 20 20" width="20px" xmlns="http://www.w3.org/2000/svg"
                         xmlns:xlink="http://www.w3.org/1999/xlink">
                        <title>flag</title>
                        <g fill="none" fill-rule="evenodd" id="Page-1" stroke="none" stroke-width="1">
                            <g fill="#C4C4C4" fill-rule="nonzero" id="red-flag-icon">
                                <path
                                    d="M19.6913158,9.16638718 C18.435845,8.5429851 17.2744141,7.7465324 16.2411158,6.80040824 C16.7719036,4.79727703 17.1657105,2.76046652 17.4198158,0.704048522 C17.4794158,0.224984194 17.2121491,0.0703861435 17.1291491,0.0344895873 C16.895251,-0.0543768588 16.6309855,0.0330951508 16.4966491,0.243847352 C14.6724491,2.42222604 12.1737491,2.17367815 9.52821578,1.90906165 C6.86204912,1.6429148 4.11134912,1.37290882 2.07208245,3.70934547 C1.78690871,3.35407768 1.31697051,3.20271901 0.877515782,3.32459693 L0.831615782,3.33743852 C0.226907892,3.50694804 -0.126312861,4.13289323 0.0419157821,4.73687191 L4.11154912,19.2715173 C4.22961475,19.6922028 4.61328715,19.9834314 5.05101578,19.9846245 C5.14025972,19.9846245 5.22907195,19.9722601 5.31501578,19.9482622 L5.67111578,19.8489894 L5.67144912,19.8489894 C5.92097535,19.7794061 6.13257542,19.6137224 6.25968142,19.3884011 C6.38678742,19.1630799 6.41898292,18.8965864 6.34918245,18.6475692 L5.08878245,14.1454624 C6.92431578,11.7898299 9.48211578,12.0392761 12.1883824,12.3090492 C14.8915158,12.5785229 17.6838158,12.8566463 19.7350491,10.4084613 L19.7360158,10.4071638 C19.9374953,10.1565138 20.0204669,9.83112197 19.9635491,9.51483994 C19.9335493,9.36206304 19.8324592,9.23266989 19.6913158,9.16638718 L19.6913158,9.16638718 Z M5.67861578,19.0619266 C5.63855732,19.1337106 5.57130882,19.1864457 5.49194912,19.2083074 L5.13581578,19.3075469 C4.97084388,19.353336 4.79987038,19.2571881 4.75364912,19.0926333 L0.683815782,4.55785489 C0.614347952,4.3075496 0.760779592,4.0483093 1.01131578,3.97805398 L1.05688245,3.96537874 C1.0981025,3.95379496 1.14072624,3.94797919 1.18354912,3.94797919 C1.39497951,3.94831809 1.58049431,4.08868733 1.63791578,4.29177458 L1.67401578,4.42072273 L1.67401578,4.42142136 L3.75831578,11.8653824 L5.70724912,18.8263867 C5.72956628,18.9055688 5.71925765,18.9903683 5.67861578,19.0619266 L5.67861578,19.0619266 Z M19.2229158,9.98216054 C17.3983824,12.1598739 14.8993491,11.9108602 12.2548158,11.6468758 C9.62038245,11.3840558 6.90148245,11.1129187 4.86974912,13.3621257 L3.04874912,6.85882747 L2.36064912,4.4011942 C4.19624912,2.0459942 6.75384912,2.30132883 9.46214912,2.57120174 C12.0337491,2.82720174 14.6883824,3.09231727 16.7079158,1.00442851 C16.4590112,2.90076108 16.0880214,4.77913031 15.5972491,6.62787854 C15.5308136,6.86691684 15.6061567,7.12286796 15.7915824,7.2880558 C16.8511256,8.25617577 18.0371328,9.07665225 19.3172824,9.72712532 C19.3101554,9.81923116 19.2774803,9.90753885 19.2229158,9.98216054 Z"
                                    id="Shape"></path>
                            </g>
                        </g>
                    </svg>
                </span>
            </div>
        </div>
        <div class="no-display" id="add-link-container" ontouchend="cancelAddLink(event)">
            <div class="overlay-actions bg-white border-top" ontouchend="stopPropagation(event)">
                <input id="link-input"
                       onkeyup="(event.keyCode === 13 && applyLinkToSelection(event)) || (event.keyCode !== 13 && onLinkChange(event))"
                       placeholder="https://"
                       type="text"/>

                <span class="btn circle-container bg-blue" id="cancel-link-button"
                      ontouchend="cancelAddLink(event)">
                    <svg class="m-small" height="15px" version="1.1" viewBox="0 0 15 15" width="15px"
                         xmlns="http://www.w3.org/2000/svg"
                         xmlns:xlink="http://www.w3.org/1999/xlink">
                        <title>Times</title>
                        <g fill="none" fill-rule="evenodd" id="Page-1" stroke="none" stroke-width="1">
                            <g fill="white" fill-rule="nonzero" id="Times---FontAwesome-Copy">
                                <path
                                    d="M14.5848388,11.7366211 C14.5848388,11.4297011 14.4620708,11.1227811 14.2410884,10.9017987 L10.6317091,7.29241941 L14.2410884,3.6830401 C14.4620708,3.4620577 14.5848388,3.15513769 14.5848388,2.84821768 C14.5848388,2.54129767 14.4620708,2.23437766 14.2410884,2.01339526 L12.5714436,0.34375041 C12.3504612,0.122768003 12.0435411,0 11.7366211,0 C11.4297011,0 11.1227811,0.122768003 10.9017987,0.34375041 L7.29241941,3.95312971 L3.6830401,0.34375041 C3.4620577,0.122768003 3.15513769,0 2.84821768,0 C2.54129767,0 2.23437766,0.122768003 2.01339526,0.34375041 L0.34375041,2.01339526 C0.122768003,2.23437766 0,2.54129767 0,2.84821768 C0,3.15513769 0.122768003,3.4620577 0.34375041,3.6830401 L3.95312971,7.29241941 L0.34375041,10.9017987 C0.122768003,11.1227811 0,11.4297011 0,11.7366211 C0,12.0435411 0.122768003,12.3504612 0.34375041,12.5714436 L2.01339526,14.2410884 C2.23437766,14.4620708 2.54129767,14.5848388 2.84821768,14.5848388 C3.15513769,14.5848388 3.4620577,14.4620708 3.6830401,14.2410884 L7.29241941,10.6317091 L10.9017987,14.2410884 C11.1227811,14.4620708 11.4297011,14.5848388 11.7366211,14.5848388 C12.0435411,14.5848388 12.3504612,14.4620708 12.5714436,14.2410884 L14.2410884,12.5714436 C14.4620708,12.3504612 14.5848388,12.0435411 14.5848388,11.7366211 Z"
                                    id="Path"></path>
                            </g>
                        </g>
                    </svg>
                </span>
                <span class="btn circle-container bg-blue no-display" id="apply-link-button"
                      ontouchend="applyLinkToSelection(event)">
                        <svg class="m-small" viewBox="0 0 512 512"
                             xmlns="http://www.w3.org/2000/svg">
                            <path
                                d="M470.6 105.4c12.5 12.5 12.5 32.8 0 45.3l-256 256c-12.5 12.5-32.8 12.5-45.3 0l-128-128c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0L192 338.7 425.4 105.4c12.5-12.5 32.8-12.5 45.3 0z"
                                fill="white"/>
                        </svg>
                </span>
            </div>
        </div>
    </div>
</div>

</body>


                    <script>const ELEMENTS_TYPES = {
    'text': 'text',
    'link': 'link',
    'user': 'user',
    'rich_text_section': 'rich_text_section',
    'rich_text_list': 'rich_text_list',
};

const CH_LIST_TYPES = {
    'ORDERED': 'ordered',
    'BULLET': 'bullet'
};

function createContentElementStyle() {
    return {
        bold: undefined,
        italic: undefined,
        strike: undefined,
        under_line: undefined,
        list_type: undefined
    };
}

function createContentElements() {
    return {
        type: undefined,
        url: undefined,
        style: undefined,
        elements: undefined,
        text: undefined,
        user_id: undefined,
        user_name: undefined
    };
}

var messageText = '';

function getChObjectMessage(htmlString, parentPayLoad, isRoot) {
    messageText = '';
    var components = htmlToObject(htmlString, parentPayLoad, isRoot);
    return{
        content: {
            text: messageText,
            components: [components]
        }
    };
}

function htmlToObject(htmlString, parentPayLoad, isRoot) {
    var payload = createContentElements();
    var root = typeof htmlString === 'string' ? convertStringToHTML(htmlString) : htmlString;
    if (root.nodeType !== 3) {
        if (root.nodeName === 'UL') {
            payload.type = ELEMENTS_TYPES.rich_text_list;
            payload.style = payload.style || createContentElementStyle();
            payload.style.list_type = CH_LIST_TYPES.BULLET;
        } else if (root.nodeName === 'OL') {
            payload.type = ELEMENTS_TYPES.rich_text_list;
            payload.style = payload.style || createContentElementStyle();
            payload.style.list_type = CH_LIST_TYPES.ORDERED;
        } else {
            payload.type = ELEMENTS_TYPES.rich_text_section;
        }
        if (root.nodeName === 'B') {
            payload.style = payload.style || createContentElementStyle();
            payload.style.bold = true;
        }

        if (root.nodeName === 'U') {
            payload.style = payload.style || createContentElementStyle();
            payload.style.under_line = true;
        }

        if (root.nodeName === 'I') {
            payload.style = payload.style || createContentElementStyle();
            payload.style.italic = true;
        }

        if (root.nodeName === 'STRIKE') {
            payload.style = payload.style || createContentElementStyle();
            payload.style.strike = true;
        }
    }
    payload['elements'] = [];
    if (root.nodeName === 'DIV' && !isRoot) {
        payload['elements'].push({
            type: ELEMENTS_TYPES.text,
            text: '\n'
        });
        messageText += '\n';
    }
    for (var i = 0; i < root.childNodes.length; i++) {
        //todo for user mention and dynamic fields
        if ((root.childNodes[i].nodeName === 'SPAN' && (root.childNodes[i]['classList'].contains('user-mention') ||
                root.childNodes[i]['classList'].contains('h-dynamic-field'))) ||
            root.childNodes[i].nodeName === '#text') {
            var element = createContentElements();
            if (root.childNodes[i].nodeName === '#text') {
                element.type = ELEMENTS_TYPES.text;
                element.text = root.childNodes[i].textContent || '';
            } else {
                element.type = ELEMENTS_TYPES.user;
                element.text = '';
                if (root.childNodes[i]['classList'].contains('h-dynamic-field')) {
                    element.user_id = $(root.childNodes[i]).attr('field-code');
                } else {
                    element.user_id = root.childNodes[i].textContent || '';
                }
                if (element.user_id) {
                    element.user_name = this.userMap[element.user_id].first_name + ' ' + this.userMap[element.user_id].last_name;

                }
            }
            if ((parentPayLoad.style && parentPayLoad.style.bold) ||
                (payload.style && payload.style.bold)) {
                element.style = element.style || createContentElementStyle();
                element.style.bold = true;
            }
            if ((parentPayLoad.style && parentPayLoad.style.italic) ||
                (payload.style && payload.style.italic)) {
                element.style = element.style || createContentElementStyle();
                element.style.italic = true;
            }
            if ((parentPayLoad.style && parentPayLoad.style.strike) ||
                (payload.style && payload.style.strike)) {
                element.style = element.style || createContentElementStyle();
                element.style.strike = true;
            }
            if ((parentPayLoad.style && parentPayLoad.style.under_line) ||
                (payload.style && payload.style.under_line)) {
                element.style = element.style || createContentElementStyle();
                element.style.under_line = true;
            }
            messageText += (element.text || element.user_name);
            payload['elements'].push(element);
        } else if (root.childNodes[i].nodeName === 'A') {
            var element = createContentElements();
            element.type = ELEMENTS_TYPES.link;
            element.text = root.childNodes[i].textContent || '';
            element.url = root.childNodes[i]['href'] || '';
            payload['elements'].push(element);
            messageText += element.text;
        } else if (root.childNodes[i].nodeName === 'BR') {
            payload['elements'].push({
                type: ELEMENTS_TYPES.text,
                text: '\n'
            });
            messageText += '\n';
        } else {
            payload['elements'].push(htmlToObject(root.childNodes[i], payload))
        }
    }
    return payload;
}

function jsonToHtml(components, isList) {
    var html = "";
    if (components) {
        for (let i = 0; i < components.length; i++) {
            let htmlBlock = "";
            if (components[i].type === ELEMENTS_TYPES.text) {
                htmlBlock += components[i].text;
                var urlRegex = /(https?:\/\/[^\s]+)/g;
                htmlBlock = htmlBlock.replace(urlRegex, url => '<a target="_blank" href="' + url + '">' + url + '</a>');
            } else if (components[i].type === ELEMENTS_TYPES.user) {
                htmlBlock += '<span field-code="' + components[i].user_id + '" class="h-dynamic-field" contenteditable="false">@' + components[i].user_name + '</span>';
            } else if (components[i].type === ELEMENTS_TYPES.link) {
                htmlBlock += '<a href="' + components[i].url + '" >' + components[i].text + '</a>';
            } else if (components[i].type === ELEMENTS_TYPES.rich_text_section) {
                if (isList) {
                    htmlBlock += "<li>" + jsonToHtml(components[i].elements) + "</li>";
                } else {
                    htmlBlock += jsonToHtml(components[i].elements);
                }
            } else if (components[i].type === ELEMENTS_TYPES.rich_text_list) {
                let listStyle = components[i].style;
                if (listStyle && listStyle.list_type === CH_LIST_TYPES.BULLET) {
                    htmlBlock += "<ul>" + jsonToHtml(components[i].elements, true) + "</ul>";
                } else {
                    htmlBlock += "<ol>" + jsonToHtml(components[i].elements, true) + "</ol>";
                }
            }
            let style = components[i].style;
            if (style && style.bold) {
                htmlBlock = "<b>" + htmlBlock + "</b>";
            }
            if (style && style.italic) {
                htmlBlock = "<i>" + htmlBlock + "</i>";
            }
            if (style && style.strike) {
                htmlBlock = "<strike>" + htmlBlock + "</strike>";
            }
            if (style && style.under_line) {
                htmlBlock = "<u>" + htmlBlock + "</u>";
            }
            html += htmlBlock;
        }
    }
    html = html.replace(/\n/g, '<br>');
    return html;
}

function convertStringToHTML(str) {
    var parser = new DOMParser();
    var doc = parser.parseFromString(str, 'text/html');
    if (doc.body.childNodes.length > 1) {
        return doc.body;
    } else {
        return doc.body.childNodes[0];
    }
}
</script>
                

                    <script>const HANDLERS = {
    HEIGHT_CHANGED: 'heightChanged',
    EXPAND_TOGGLED: 'expandToggled',
    ADD_VOICE_MESSAGE_CLICKED: 'addVoiceMessageClicked',
    ADD_IMAGE_CLICKED: 'addImageClicked',
    SEND_CLICKED: 'sendClicked',
    TEXT_CHANGED: 'textChanged',
    TEXT_FOCUSED: 'textFocused',
    RED_FLAG_TOGGLED: 'redFlagToggled',
    CANCEL_EDIT_CLICKED: 'cancelEditClicked'
};

//editor element
var editor, editorConfigurations = {
    'initialContent': '',
    'showRedFlag': true,
    'placeholderText': '',
    'androidBridgeName': undefined, // Not needed in iOS
    'eventsHandlers': {}
};

//containers HTML Elements
var richTextContainer, textActionsContainer, messageActionsContainer, sendActionsContainer, loadingOverlayContainer,
    addLinkContainer,
    linkInput;

//actions HTML Elements
var toggleTextAction, voiceNoteAction, cancelEditAction, pollAttachmentAction, redFlagAction, applyLinkAction,
    cancelLinkAction;

//icons Elements
var redFlagIcon, finishEditIcon, sendMessageIcon;

var editorScrollHeight, selectionRange, editorObserver;
var renderViewVariables = {
    _isShowTextOptions: false,
    get showTextOptions() {
        return this._isShowTextOptions;
    },
    set showTextOptions(isShow) {
        if (isShow) {
            textActionsContainer.style.width = '100%';
            sendActionsContainer.style.width = renderViewVariables.editMode ? '100px' : '50px';
            messageActionsContainer.classList.add('no-display');
        } else {
            textActionsContainer.style.width = '0px';
            sendActionsContainer.style.width = 'unset';
            messageActionsContainer.classList.remove('no-display');
        }
        this._isShowTextOptions = isShow;
    },
    _isRedFlag: false,
    get redFlag() {
        return this._isRedFlag;
    },
    set redFlag(isFlag) {
        if (isFlag) {
            redFlagIcon.style.fill = '#ca4545';
        } else {
            redFlagIcon.style.fill = '#C4C4C4';
        }
        this._isRedFlag = isFlag;
    },
    _isShowRedFlag: false,
    get showRedFlag() {
        return this._isShowRedFlag;
    },
    set showRedFlag(isFlag) {
        if (isFlag) {
            redFlagAction.classList.remove('no-display');
        } else {
            redFlagAction.classList.add('no-display');
        }
        this._isShowRedFlag = isFlag;
    },
    _isDisabled: false,
    get disabled() {
        return this._isDisabled;
    },
    set disabled(isDis) {
        editor.setAttribute('contenteditable', !isDis);
        this._isDisabled = isDis;
    },
    _isEditMode: false,
    get editMode() {
        return this._isEditMode;
    },
    set editMode(isEdit) {
        if (isEdit) {
            richTextContainer.classList.add('edit-mode');
            if (isEdit) {
                moveCursorAtTheEnd();
            }
        } else {
            richTextContainer.classList.remove('edit-mode');
        }
        renderViewVariables.showTextOptions = false;
        this._isEditMode = isEdit;
    },
    _isExpanded: false,
    get expanded() {
        return this._isExpanded;
    },
    set expanded(isExpand) {
        if (isExpand) {
            richTextContainer.classList.add('expanded');
        } else {
            richTextContainer.classList.remove('expanded');
        }
        this._isExpanded = isExpand;
    },
    _isAttachments: false,
    get attachmentsEnabled() {
        return this._isAttachments;
    },
    set attachmentsEnabled(isAttach) {
        if (isAttach) {
            pollAttachmentAction.classList.remove('no-display');
        } else {
            pollAttachmentAction.classList.add('no-display');
        }
        this._isAttachments = isAttach;
    },
    _isVoiceNotes: false,
    get voiceNotesEnabled() {
        return this._isVoiceNotes;
    },
    set voiceNotesEnabled(isVoice) {
        if (isVoice) {
            voiceNoteAction.classList.remove('no-display');
        } else {
            voiceNoteAction.classList.add('no-display');
        }
        this._isVoiceNotes = isVoice;
    },
    _isPolls: false,
    get pollsEnabled() {
        return this._isPolls;
    },
    set pollsEnabled(isEnabled) {
        if (isEnabled) {
            //todo: show polls button
        } else {
            //todo: hide polls button
        }
        this._isPolls = isEnabled;
    },
    _isLoading: false,
    get loading() {
        return this._isLoading;
    },
    set loading(isLoad) {
        if (isLoad) {
            loadingOverlayContainer.classList.remove('no-display');
        } else {
            loadingOverlayContainer.classList.add('no-display');
        }
        this._isLoading = isLoad;
    },
    _placeholderText: '',
    get placeholder() {
        return this._placeholderText;
    },
    set placeholder(textPlaceholder) {
        editor.setAttribute('placeholder', textPlaceholder);
        this._placeholderText = textPlaceholder;
    },
    _isAddLink: false,
    get showAddLink() {
        return this._isAddLink;
    },
    set showAddLink(isShow) {
        if (isShow) {
            addLinkContainer.classList.remove('no-display');
        } else {
            addLinkContainer.classList.add('no-display');
        }
        this._isAddLink = isShow;
    },
    _isApplyLink: false,
    get showApplyLink() {
        return this._isApplyLink;
    },
    set showApplyLink(isShow) {
        if (isShow) {
            applyLinkAction.classList.remove('no-display');
            cancelLinkAction.classList.add('no-display');
        } else {
            applyLinkAction.classList.add('no-display');
            cancelLinkAction.classList.remove('no-display');
        }
        this._isApplyLink = isShow;
    },
    _isLinkError: false,
    get linkError() {
        return this._isLinkError;
    },
    set linkError(isError) {
        if (isError) {
            linkInput.classList.add('error');
        } else {
            linkInput.classList.remove('error');
        }
        this._isLinkError = isError;
    },
    _isSendButtonDisabled: false,
    get sendButtonDisabled() {
        return this._isSendButtonDisabled;
    },
    set sendButtonDisabled(isDisabled) {
        if (isDisabled) {
            sendMessageIcon.classList.add('disabled');
            sendMessageIcon.classList.remove('circle-container', 'bg-green');
        } else {
            sendMessageIcon.classList.remove('disabled');
            sendMessageIcon.classList.add('circle-container', 'bg-green');
        }
        this._isSendButtonDisabled = isDisabled;
    },
};

const RichEditor = {
    init: (configurations) => {
        editorConfigurations = configurations;
        if (configurations.initialContent) {
            setEditorInnerHtml(configurations.initialContent);
        }
        if (configurations.placeholderText) {
            renderViewVariables.placeholder = configurations.placeholderText;
        }

        renderViewVariables.showRedFlag = configurations.showRedFlag;
        renderViewVariables.disabled = configurations.disabled;
        renderViewVariables.editMode = configurations.editMode;
        renderViewVariables.attachmentsEnabled = configurations.sendAttachmentsEnabled;
        renderViewVariables.voiceNotesEnabled = configurations.sendVoiceNotesEnabled;
        renderViewVariables.pollsEnabled = configurations.addPollsEnabled;
    },
    toObject: (htmlString) => {
        var wrapHtmlString = '<div>' + htmlString + '</div>';
        return getChObjectMessage(wrapHtmlString, {}, true);
    },
    toHTML: (jsonObject) => {
        return jsonToHtml(getJsonElements(jsonObject));
    },
    setContentHtml: (htmlString, editMode) => {
        setEditorInnerHtml(htmlString);
        renderViewVariables.editMode = editMode;
    },
    setContentJson: (jsonObject, editMode) => {
        var htmlString = jsonToHtml(getJsonElements(jsonObject));
        setEditorInnerHtml(htmlString);
        renderViewVariables.editMode = editMode;
    },
    disable: (isDisabled) => {
        renderViewVariables.disabled = isDisabled;
    },
    destroy: () => {
        //todo: destroy the component
    },
    setRedFlag: (redFlag) => {
        renderViewVariables.redFlag = redFlag;
    },
    getRedFlag: () => {
        return renderViewVariables.redFlag;
    },
    enableAttachments: (isEnabled) => {
        renderViewVariables.attachmentsEnabled = isEnabled;
    },
    enableVoiceNotes: (isEnabled) => {
        renderViewVariables.voiceNotesEnabled = isEnabled;
    },
    enablePolls: (isEnabled) => {
        renderViewVariables.pollsEnabled = isEnabled;
    },
    reset: () => {
        setEditorInnerHtml('');
    },
    setLoading: (isLoading) => {
        renderViewVariables.loading = isLoading;
    },
    setEditMode: (isEditMode) => {
        renderViewVariables.editMode = isEditMode;
    },
    getContent: getContent,
    disableSendButton: (isDisabled) => {
        renderViewVariables.sendButtonDisabled = isDisabled;
    },
    setExpand: (isExpanded) => {
        renderViewVariables.expanded = isExpanded;
    }
};

window.onload = function () {
    editor = document.getElementById('editor');
    editorScrollHeight = editor.scrollHeight;
    //assign containers
    richTextContainer = document.getElementById('rich-text-container');
    textActionsContainer = document.getElementById('text-actions-container');
    messageActionsContainer = document.getElementById('message-actions-container');
    sendActionsContainer = document.getElementById('send-actions-container');
    loadingOverlayContainer = document.getElementById('loading-overlay');
    addLinkContainer = document.getElementById('add-link-container');
    linkInput = document.getElementById('link-input');

    //assign actions
    toggleTextAction = document.getElementById('toggle-text-action');
    voiceNoteAction = document.getElementById('voice-note-action');
    cancelEditAction = document.getElementById('cancel-edit-action');
    pollAttachmentAction = document.getElementById('poll-attachment-action');
    redFlagAction = document.getElementById('red-flag-action');
    applyLinkAction = document.getElementById('apply-link-button');
    cancelLinkAction = document.getElementById('cancel-link-button');

    //assign icons
    redFlagIcon = document.getElementById('red-flag-icon');
    finishEditIcon = document.getElementById('finish-edit-icon');
    sendMessageIcon = document.getElementById('send-message-icon');

    assignOnChange();

};

function getContent(asString) {
    var content = document.getElementById('editor').innerHTML;
    return asString ? content : {content: content};
}

function execCmdTouch($event, cmd, value) {
    if ($event) {
        $event.preventDefault();
        $event.stopPropagation();
        $event.stopImmediatePropagation();
    }

    try {
        document.execCommand(cmd, false, value);
        keepCaretPosition();
    } catch (error) {
    }
}

function execCmd($event, cmd, value) {
    if ($event) {
        $event.preventDefault();
        $event.stopPropagation();
        $event.stopImmediatePropagation();
    }

    try {
        document.execCommand(cmd, false, value);
        keepCaretPosition();
    } catch (error) {
        console.log("error")
    }
}

function toggleTextActionsTouch(event) {
    renderViewVariables.showTextOptions = !renderViewVariables.showTextOptions;
    event.preventDefault();
}

function toggleTextActions(event) {
    renderViewVariables.showTextOptions = !renderViewVariables.showTextOptions;
    keepCaretPosition();
    event.preventDefault();
}

function keepCaretPosition() {
    try {
        let range = window.getSelection().getRangeAt(0) || new Range();
        getSelection().addRange(range);
    } catch (error) {

    }
}

function toggleRedFlag($event) {
    if ($event) {
        $event.preventDefault();
        $event.stopPropagation();
        $event.stopImmediatePropagation();
    }
    renderViewVariables.redFlag = !renderViewVariables.redFlag;
    callMobileHandler(HANDLERS.RED_FLAG_TOGGLED, renderViewVariables.redFlag);
}

function emitExpand($event) {
    if ($event) {
        $event.preventDefault();
        $event.stopPropagation();
        $event.stopImmediatePropagation();
    }

    if (editorConfigurations.eventsHandlers[HANDLERS.EXPAND_TOGGLED]) {
        renderViewVariables.expanded = !renderViewVariables.expanded;
        callMobileHandler(HANDLERS.EXPAND_TOGGLED, renderViewVariables.expanded);
        if (!renderViewVariables.expanded) {
            editorScrollHeight = editor.scrollHeight;
            callMobileHandler(HANDLERS.HEIGHT_CHANGED, editorScrollHeight);
        }
    }
}

function sendClicked($event) {
    if ($event) {
        $event.preventDefault();
        $event.stopPropagation();
        $event.stopImmediatePropagation();
    }
    if (!renderViewVariables.sendButtonDisabled) {
        var wrapHtmlString = '<div>' + getContent(true) + '</div>';
        var content = getChObjectMessage(wrapHtmlString, {}, true);
        callMobileHandler(HANDLERS.SEND_CLICKED, content);
    }
}

function voiceMessageClicked($event) {
    if ($event) {
        $event.stopPropagation();
        $event.stopImmediatePropagation();
    }
    callMobileHandler(HANDLERS.ADD_VOICE_MESSAGE_CLICKED);
}

function attachFileClicked($event) {
    if ($event) {
        $event.stopPropagation();
        $event.stopImmediatePropagation();
    }
    callMobileHandler(HANDLERS.ADD_IMAGE_CLICKED);
}

function onEditorFocused($event) {
    if ($event) {
        $event.preventDefault();
        $event.stopPropagation();
        $event.stopImmediatePropagation();
    }
    callMobileHandler(HANDLERS.TEXT_FOCUSED);
}

function onCancelEditClick($event) {
    if ($event) {
        $event.preventDefault();
        $event.stopPropagation();
        $event.stopImmediatePropagation();
    }
    RichEditor.setContentHtml('', false);
    callMobileHandler(HANDLERS.CANCEL_EDIT_CLICKED);
}


function callMobileHandler(handlerName, content) {
    if (editorConfigurations.eventsHandlers[handlerName]) {
        try {
            if (typeof content === 'undefined') {
                window[editorConfigurations.androidBridgeName][editorConfigurations.eventsHandlers[handlerName]]();
            } else {
                if (typeof content === 'object') {
                    content = JSON.stringify(content);
                }
                window[editorConfigurations.androidBridgeName][editorConfigurations.eventsHandlers[handlerName]](content);
            }
        } catch (e) {
            try {
                window.webkit.messageHandlers[editorConfigurations.eventsHandlers[handlerName]].postMessage(content);
            } catch (e) {
                alert(e);
            }
        }
    }
}

function assignOnChange() {
    var MutationObserver = window.MutationObserver || window.WebKitMutationObserver || window.MozMutationObserver;
    editorObserver = new MutationObserver(contentChanged);
    observeEditor();
}

function observeEditor() {
    editorObserver && editorObserver.observe(editor, {childList: true, subtree: true, characterData: true});
}

function setEditorInnerHtml(htmlString) {
    editorObserver && editorObserver.disconnect(editor);
    editor.innerHTML = htmlString;
    checkHeightToTrigger();
    observeEditor();
}

function contentChanged() {
    var wrapHtmlString = '<div>' + getContent(true) + '</div>';
    var content = getChObjectMessage(wrapHtmlString, {}, true);
    callMobileHandler(HANDLERS.TEXT_CHANGED, content.content.text);
    checkHeightToTrigger();
}

function checkHeightToTrigger() {
    if (editor.scrollHeight !== editorScrollHeight) {
        editorScrollHeight = editor.scrollHeight;
        callMobileHandler(HANDLERS.HEIGHT_CHANGED, editorScrollHeight);
    }
}

function getJsonElements(jsonObject) {
    var jsonObjectElements = [];
    if (Array.isArray(jsonObject)) {
        jsonObjectElements = jsonObject;
    } else if (jsonObject && Array.isArray(jsonObject.elements)) {
        jsonObjectElements = jsonObject.elements;
    }
    return jsonObjectElements;
}

function applyLinkToSelection($event) {
    if ($event) {
        $event.preventDefault();
        $event.stopPropagation();
        $event.stopImmediatePropagation();
    }
    var linkValue = linkInput.value;
    if (linkValue && hasHttp(linkValue)) {
        getSelection().removeAllRanges();
        getSelection().addRange(selectionRange);

        self.execCmd(null, 'createLink', linkValue);
        linkInput.value = '';
        renderViewVariables.showAddLink = false;
    } else {
        renderViewVariables.linkError = true;
    }
}

function cancelAddLink($event) {
    if ($event) {
        $event.preventDefault();
        $event.stopPropagation();
        $event.stopImmediatePropagation();
    }
    linkInput.value = '';
    renderViewVariables.showAddLink = false;
}

function showAddLink($event) {
    if ($event) {
        $event.preventDefault();
        $event.stopPropagation();
        $event.stopImmediatePropagation();
    }
    var selection = window.getSelection();
    selectionRange = selection.getRangeAt(0);
    renderViewVariables.showAddLink = true;
    linkInput.value = '';
}

function stopPropagation($event) {
    if ($event) {
        $event.stopPropagation();
        $event.stopImmediatePropagation();
    }
}

function hasHttp(link) {
    return /^[\s]*http(s)?\:/.test(link);
};

function onLinkChange($event) {
    if ($event) {
        $event.preventDefault();
        $event.stopPropagation();
        $event.stopImmediatePropagation();
    }
    if (linkInput.value) {
        renderViewVariables.showApplyLink = true;
    } else {
        renderViewVariables.showApplyLink = false;
    }

    if (renderViewVariables.linkError) {
        renderViewVariables.linkError = false;
    }
}

function moveCursorAtTheEnd() {
    var selection = document.getSelection();
    var range = document.createRange();

    if (editor.lastChild && editor.lastChild.nodeType == 3) {
        range.setStart(editor.lastChild, editor.lastChild.length);
    } else {
        range.setStart(editor, editor.childNodes.length);
    }
    selection.removeAllRanges();
    selection.addRange(range);

}
</script>
                

</html>
